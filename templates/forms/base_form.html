<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 

    <title> {%block title%}{%endblock%} </title>
    {% block style %} {% endblock %}
    <link rel="icon" type="image/jpg" href="{{ url_for('static', filename='icon.jpg') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#sendEmail').click(function (e) {
                e.preventDefault();  
    
                var formData = $('#{{ form_id }}').serialize(); 
    
                $.ajax({
                    type: 'POST',
                    url: '/verification/{{ service }}',  
                    data: formData,
                    success: function (response) {
                        if (response.redirect_url) {
                            window.location.href = response.
                            redirect_url;
                        } else {
                            alert(response.message)
                        } 
                    },
                    error: function () {
                        alert('There was an error sending the verification email. Please try again later.');
                    }
                });
            });
    
            $('#submitForm').click(function (e) {
                e.preventDefault();  
    
                var formData = $('#{{ form_id }}').serialize();  
    
                $.ajax({
                    type: 'POST',
                    url: '{{ action_url }}',  
                    data: formData,
                    success: function (response) {
                        if (response.redirect_url) {
                            window.location.href = response.
                            redirect_url;
                        } else [
                            alert(response.message)
                        ]
                        
                    },
                    error: function () {
                        alert('Error submitting form');
                    }
                });
            });
        });

        function validateForm(e) {
            var VerificationCode = document.getElementById('verification-code');
            var submitButton = e.target;

            if (submitButton.name === 'verification-email') {
                VerificationCode.removeAttribute('required');
            } else {
                VerificationCode.setAttribute('required', 'required');
            }
        }
    </script>
    
</head>
<!-- Below is the script for allowing the user to press the 'send verification email' without having the input box for 'verification code' (it skips the input box)
 being required. However it will add the required attribute should the user try and submit the entire form-->
<script>

</script>

<body style="background-color: rgb(222, 211, 184);">

    <nav>
        <ul>
            <li> <a href="{{ url_for('routes.index') }}"> Home</a> </li>
            <li>
                <a href="#"> Menu </a>
                <ul class="dropdown">
                    <li> <a href="/nikah" > Nikah </a></li>
                    <li> <a href="/madrasah" > Madrasah </a></li>
                    <li> <a href="/functions" > Functions </a></li>
                    <li> <a href="/tours" > Tours </a></li>
                    <li> <a href="/about-us" > About Us </a></li>
                </ul>
            </li>
        </ul>
    </nav>   
    
    <h1> {%block head%} {%endblock%} </h1>
    
    <div id="responseMessage">
        {% with messages = get_flashed_messages(with_categories=True) %}
            {% if messages %}
                <ul>
                {% for category, message in messages %}
                    <h3>{{ message }}</h3>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}        
    </div>

    <!--REMOVE ALL TESTING VALUE AFTER COMPLETION-->
    <form id = "{{ form_id }}" method = 'POST' onsubmit=" return validateForm()" action="{{ action_url }}" autocomplete="off">

        <div>
            <label for='first-name'>{%block label1 %}{%endblock%}</label>
            <input type = 'text' id="first-name" name="first_name" value="Testing Value" pattern="^([A-Za-z]+[,.]?[ ]?|[A-Za-z]+['-]?)+$" required>
        </div>

        <br>

        <div>
            <label for='last-name'>{%block label2%} {%endblock%}</label>
            <input type = 'text' id= "last-name" name="last_name" value="Testing Value" pattern="^([A-Za-z]+[,.]?[ ]?|[A-Za-z]+['-]?)+$" required>
        </div>

        <br>
        
        <div>
            <label for ='email'> Email: </label>
            <input type="email" id="email" name="email" placeholder="youremail@gmail.com" value="verificationmasjidalansar@proton.me" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}" required>
        </div>

        <br>

        <div>
            <label for='phone-number'>Phone Number:</label>
            <input type="tel" id="phone-number" name="phone_number" placeholder="+447627256926"  pattern="[0-9]{10}">
        </div>

        <br>

        {% block content %} {%endblock%}
        
        <div>
            <label for=" date"> Date of Booking: </label>
            <input type="date" id="date" name="date" min="2025-01-01" max="2030-12-31" required>
        </div>

        <br>

        <div>
            <label for=" time"> Time of Booking: </label>
            <input type="time" id="time" name="time" step= "900" min="16:30:00" max="21:00:00" required>
        </div>
        
        <br>
        
        <button type="button" id="sendEmail" name="verification-email" formaction="/verification" onclick="validateForm(event)">Send Verification Email</button>
        <br><br>

        <label for="verification-code">Verification Code:</label>
        <input type="number" id="verification-code" name="verification-code" required><br><br>
        
        <button type="submit" id="submitForm" formaction="{{ action_url }}" onclick="validateForm(event)">Submit Form</button>

    </form>
    {% block scripts %} {% endblock %}       
</body>    
</html>